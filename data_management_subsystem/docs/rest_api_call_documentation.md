# Front-end Server REST APIs Call Documentation.
This file documents the format to send the REST API calls from the server generating the web page to the front-end server that handles these API calls.

# Connection setup
The REST API calls should be sent to the front-end server with the following ip address: `https://172.208.66.211`. Currently, the server is at its development stage, so all calls should be sent to port 5000, which can be specified by typing `https://172.208.66.211:5000`. From now on, this address will be referred as `<server_ip>`. To activate the Flask handler, do the following:
  1. SSH to the front-end server using the .pem authentication key.
  2. Type `cd frontend-REST-repo`
  3. Type `source .env/bin/activate`
  4. Type `cd data_management_subsystem`.
  5. Type `flask run --host 0.0.0.0`. If you want the front-end server to listen on a different port, please open that port in Ubuntu's `ufw` firewall program settings, and under Microsoft Azure's VM Network Settings page. Then, type `flask run --host 0.0.0.0  --port <listening_port>`.

## Get Chat History
To send the request from the website server to the front-end server for returning the chat history from a specifc userID, send the `GET` request to `<server_ip>/get_chat/<user_id>`. The front-end server will return a JSON file under the following format:
```{
  'success': True,
  'chat_history': {
      [
        {
            'time_in_edt': <time_in_edt>,
            'content': <content>,
            'is_from_bot': <is_from_bot>,
            'citations': [<citation>, ...]
        }, 
        ...
      ]
    }
  'user_id': <user_id>
  }
  ```
Where `time_in_edt` is the time the chat has been posted, `content` is the content of the chat, `is_from_bot` where the value is 1 if the bot generated the message or 0 if generated by the user, and `user_id` is the ID of the user which the chat message pertains to, as defined in the SQL database. Note that the chat history from the AI may not always include the `citations` field as it may not be neccessary to look data online.

## Post Chat Message to Database
To send the request from the website server to the back-end server to post the user's message to the SQL server, send the `POST` message to `<server_ip>/post_chat/<user_id>` with the JSON passed using the following format: `{'chat_data': "<user_message>"}`, where `<user_message>` is the message from the user. If successful, the front-end server will return the following JSON: `{'success': True, 'user_chat_id': <user_chat_id>}`, where `<user_chat_id>` is the new chat id in the SQL database that has been posted. Otherwise, a JSON file is returned that describes the exception raised during the handling of the POST message.

## Requesting Back-end Server to Generate Response from AI
**IMPORTANT: Only send this API immediately after the front-end server handles the `Post Chat` message successfully.**

After the front-end server handled the `post_chat` REST API successfully, send the following `POST` message to the front-end server, which will request the back-end server to generate a response to the user. The message should be sent to `<server_ip>/post_chat/<user_id>` with the following JSON:
`{"chat_data": <prev_user_chat_data>, "debug_mode": <debug_mode>}`, 
where `<user_id>` is the ID of the user who posted the chat message and `<prev_user_chat_data>` is the message sent from the user. If the backend-server is running in development mode (where it listens on 5000), set `<debug_mode>` to `true`. Otherwise, set the value to `false`.

If the backend server is able to generate a response from the AI model to the user, the response will also be uploaded to the SQL server, and the front-end server returns the following JSON format:
``` {
  'success': True,
  'ai_output': {
      'time_in_edt': <time_in_edt>,
      'content': <ai_response>,
      'citations': [<citation>, ...]
    }
  }
  ```
  Note that the bot may not generate citations if it is not applicable.
